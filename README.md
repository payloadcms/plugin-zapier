# Payload Zapier Plugin

This plugin can be added to a Payload project to make it simple to send Zaps to a zapier webhook address when collection data changes. It is designed to be flexible and generic to allow for any use-cases to manage zaps.

#### Requirements

- A Payload project
- A Zapier account with webhooks configured. [More](https://zapier.com/help/create/code-webhooks/trigger-zaps-from-webhooks)

## Usage

Install this plugin within your Payload as follows:

```ts
import { buildConfig } from 'payload/config';
import path from 'path';
import Users from './collections/Users';
import { zapierPlugin } from '@payloadcms/plugin-zapier';

export default buildConfig({
  plugins: [
    zapierPlugin({
      zapierCollectionSlug: 'zaps', // optional, defaults to 'zaps'
      access: { // optional, defaults to { read: () => true }
        read: () => true,
        create: () => true,
        update: () => true,
        delete: () => true,
      },
      collections: ['posts'], // optional, defaults to all collections
      enabled: async ({ req }) => false, // optional, defaults to true
    })
  ],
  // The rest of your config goes here
```

## Features

**Send Zaps**
The plugin adds a Zaps collection that allows you to configure `afterChange` and `afterDelete` events from specific collections to a Zapier webhook endpoint within the Payload admin panel.

**Adding a Zap**
To add a zap, navigate to the Zaps collection in the Payload admin panel and click the `Add Zap` button. You will be presented with a form to configure the zap. You will need to provide the following information:
  - **Title**: A name for the zap
  - **Related Collection**: What collection you want to configure the zap for (i.e. Posts)
  - **Webhook URL**: The URL of the Zapier webhook you want to send the zap to
  - **Hooks**: What events you want to trigger the zap for (`afterChange` and/or `afterDelete`)

## Plugin options

This plugin is configurable to work across many different Payload collections. A `*` denotes that the property is required.

| Option                        | Description |
| ----------------------------- | ----------- |
| **[`zapierCollectionSlug`]**  | Custom slug for the collection generated by the plugin |
| **[`collections`]**           | Array of collection slugs, denoting what collections can have zaps configured. `Array<string>` |
| **[`access`]**                | Access control for the collection generated by the plugin. |
| **[`enabled`]**               | Turn zaps on/off. `boolean | () => boolean | async () => boolean` |

#### Access-specific options

[Access control](https://payloadcms.com/docs/access-control/collections) on the collection generated by the plugin.

| Option                     | Description                                                                                                     |
|----------------------------|-----------------------------------------------------------------------------------------------------------------|
| **[`create`]**             | Determine create access on the collection.                                                                      |
| **[`read`]**               | Determine read access on the collection.                                                                        |
| **[`update`]**             | Determine update access on the collection.                                                                      |
| **[`delete`]**             | Determine delete access on the collection.                                                                      |


#### Webhook Data

The data sent to the Zapier endpoint will include:

1. The `collection` slug.
1. The `operation` used, one of: 'create', 'update', or 'delete'.
1. All the properties of the document being changed that the current user has access to.
